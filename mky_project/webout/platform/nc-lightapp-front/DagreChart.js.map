{"version":3,"sources":["webpack://[name]/./src/platform/containers/DagreChart/Component.js","webpack://[name]/./src/platform/containers/DagreChart/method.js","webpack://[name]/./node_modules/_@antv_g6@2.1.0@@antv/g6/build/plugin.tool.tooltip.js"],"names":["G6","require","G6Plugins","track","DagreChart","props","getDrawDagreData","list","data","nodes","edges","forEach","item","push","createEdges","setState","renderDagre","changeColor","state","renderShape","shape","registerNode","getPath","Util","getRectPath","initDagre","tooltipText","dagre","rankdir","nodesep","ranksep","tooltip","Plugins","getTooltip","model","getModel","title","billTypeName","billcode","billCode","transType","transTypeName","codeLabel","transTypeLabel","tips","graph","Graph","id","heigth","plugins","defaultIntersectBox","modes","default","edge","style","endArrow","label","size","node","stroke","itemClickEvent","on","wheelScrollZoom","getZoom","calculaterGraphPosition","sourceArr","graphColumnCount","graphRowCount","length","val","source","target","lenArr","itemArr","sort","a","b","graphWidth","graphHeight","dagreScrollWrap","document","querySelector","firstRender","dagreScrollWrapHeight","clientHeight","dagreScrollWrapWidth","clientWidth","dy","dx","translate","firstChangeZoom","dragNodeChangePostion","read","currentZoom","zoom","ev","isNode","selectedId","selectedType","type","getSelectId","find","elem","transtype","onSelect","color","relatedData","getRelated","fill","handleClick","extractTip","renderNewData","extract","originPk","originType","content","calculatePostionbBeforeRender","setTimeout","dagreScrollHeight","dagreScrollWidth","dagreScrollH","hasTableDy","dy2","prevDy","zoomX","zoomY","dagreScrollW","this","parentCom","nextProps","undefined","extractBtns","btnTitle","className","height","NCButton","fieldid","onClick","width","Component","flowFormatNode","map","index","act_id","text","name","act_name","isForward","sourceEdges","targetEdges","x","y","update","generateInitSelected","filter","ispassroute","equalArray","arr1","arr2","Object","prototype","toString","call","slice","JSON","stringify","keyNodeId","sources","targets","getSource","sourceIds","getTargets","targetIds","Set","nodeIds","ele","t","window","module","exports","o","e","n","i","l","m","c","d","defineProperty","enumerable","get","r","Symbol","toStringTag","value","__esModule","create","bind","hasOwnProperty","p","s","133","assign","arguments","TypeError","options","isArray","init","onMouseEnter","onMouseMove","onMouseLeave","getGraphContainer","destroy","createDOM","css","position","appendChild","domX","domY","getOuterWidth","getOuterHeight","getWidth","u","getHeight","top","_getTop","left","_getLeft","3"],"mappings":"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","file":"DagreChart.js","sourcesContent":["// 单据追溯图表\r\nimport React, { Component } from 'react';\r\nimport { NCButton } from '../../base';\r\nimport toast from '../../api/toast';\r\nimport { createEdges, dragNodeChangePostion, getRelated } from './method';\r\nimport '@antv/g6/build/plugin.tool.tooltip';\r\n\r\nconst G6 = require('@antv/g6');\r\nconst G6Plugins = require('@antv/g6/build/plugins');\r\n// import '@antv/g6/build/plugin.behaviour.analysis';\r\nG6.track(false);\r\nexport default class DagreChart extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tdata: {\r\n\t\t\t\tnodes: this.props.list,\r\n\t\t\t\tedges: createEdges(this.props.list)\r\n\t\t\t}, // 节点和线条数据\r\n\t\t\tselectedId: this.props.selectedId || '', // 选中的节点id，页面初加载时选中节点为基本节点,即基于基本节点构建的上下游关系\r\n\t\t\tselectedType: '',\r\n\t\t\t// extract: false, // 是否是路径抽取状态\r\n\t\t\trelatedData: null, // 抽取路径后相关联的节点数据，用来渲染路径抽取视图\r\n\t\t\tgraphHeight: 0, //流程图大于整个可视区的时候，图的高度\r\n\t\t\tgraphWidth: 0, //流程图大于整个可视区的时候，图的宽度\r\n\t\t\twheelScrollZoom: null //滚动鼠标滚轮之后的缩放比例\r\n\t\t};\r\n\t\tthis.dagre = null; //流程图\r\n\t\tthis.tooltip = null; //节点悬浮内容提示\r\n\t\tthis.graph = null;\r\n\t\tthis.currentZoom = null; //渲染前的画布比例\r\n\t\tthis.firstRender = true;\r\n\t\tthis.dagreScrollH = null; //dagreScroll的高度\r\n\t\tthis.dagreScrollW = null; //dagreScroll的宽度\r\n\t\tthis.dagreScrollWrapHeight = 0;\r\n\t\tthis.dagreScrollWrapWidth = 0;\r\n\t\tthis.firstChangeZoom = false; //打开单据追溯弹框之后，第一次渲染流程图的时候计算zoom，之后不计算\r\n\t\tthis.hasTableDy = null; //显示隐藏表格的时候，值计算一次位移，在流程图小于可视区的时候，在显示表格的时候高度居中\r\n\t\tthis.prevDy = null; //流程图前一次计算的Y轴的位移，是对应modal的body上边而言\r\n\t}\r\n\r\n\tcomponentWillMount() {\r\n\t\tlet { list, parentCom } = this.props;\r\n\t\tif (parentCom !== 'BillTrack') {\r\n\t\t\t//父组件不是单据追溯的时候，初始化接收渲染图的数据\r\n\t\t\tthis.getDrawDagreData(list);\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tlet { getSelectId } = this.props;\r\n\t\tthis.initDagre();\r\n\t\tif (getSelectId && typeof getSelectId === 'function') {\r\n\t\t\tgetSelectId(this.state.selectedId);\r\n\t\t}\r\n\t\t// let modalBody = document.querySelector('.u-modal-bill-track-body');\r\n\t\t// if (modalBody) {\r\n\t\t// \tmodalBody.style.minHeight = modalBody.clientHeight + 'px';\r\n\t\t// \tmodalBody.style.minWidth = modalBody.clientWidth + 'px';\r\n\t\t// }\r\n\t}\r\n\r\n\tcomponentWillReceiveProps(nextProps) {\r\n\t\tlet { list, size } = nextProps;\r\n\t\tthis.getDrawDagreData(list);\r\n\t\tif (size !== undefined && size !== this.props.size) {\r\n\t\t\tif (size == true) {\r\n\t\t\t\t//隐藏表格 图下移\r\n\t\t\t\tthis.graph.translate(0, -this.prevDy);\r\n\t\t\t} else {\r\n\t\t\t\t//显示表格 图上移\r\n\t\t\t\tthis.graph.translate(0, this.prevDy);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**接收渲染图的数据\r\n\t * list:array 是BIltrack的index.js中的dataFormat方法返回的数组\r\n\t */\r\n\tgetDrawDagreData = list => {\r\n\t\tlet data = {\r\n\t\t\tnodes: list,\r\n\t\t\tedges: []\r\n\t\t};\r\n\t\tlist.forEach(item => data.edges.push(...createEdges(item)));\r\n\t\tthis.setState({ data }, () => {\r\n\t\t\tthis.renderDagre(this.changeColor(this.state.data));\r\n\t\t});\r\n\t};\r\n\r\n\trenderShape = (G6, shape) => {\r\n\t\tif (shape === 'react') {\r\n\t\t\treturn G6.registerNode('rect', {\r\n\t\t\t\tgetPath: function getPath() {\r\n\t\t\t\t\tvar width = 136; // 一半宽\r\n\t\t\t\t\tvar height = 60; // 一半高\r\n\t\t\t\t\treturn G6.Util.getRectPath(-width / 2, -height / 2, width, height, 10);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\t/**初始化渲染并绑定节点事件\r\n\t * tooltipText:Array 流程图节点悬停的气泡提示中文\r\n\t */\r\n\tinitDagre = () => {\r\n\t\tlet { tooltipText } = this.props;\r\n\t\tthis.renderShape(G6, 'react');\r\n\t\tthis.dagre = new G6Plugins['layout.dagre']({\r\n\t\t\trankdir: 'LR', // 左右方向\r\n\t\t\tnodesep: 30, // 节点间距\r\n\t\t\tranksep: 30 // 层级间距\r\n\t\t});\r\n\t\tthis.tooltip = new G6.Plugins['tool.tooltip']({\r\n\t\t\t//每个节点的气泡提示\r\n\t\t\tgetTooltip({ item }) {\r\n\t\t\t\tconst model = item.getModel();\r\n\t\t\t\tif (model) {\r\n\t\t\t\t\tlet title = model.billTypeName;\r\n\t\t\t\t\tlet billcode = model.billCode;\r\n\t\t\t\t\tlet transType = model.transTypeName;\r\n\t\t\t\t\t// let nameLabel = tooltipText && tooltipText[0] ? tooltipText[0] : '单据名称-1';\r\n\t\t\t\t\tlet codeLabel = tooltipText && tooltipText[1] ? tooltipText[1] : '单据编号-1';\r\n\t\t\t\t\tlet transTypeLabel = tooltipText && tooltipText[2] ? tooltipText[2] : '转单类型-1';\r\n\t\t\t\t\tlet tips = '';\r\n\t\t\t\t\tif (title && billcode) {\r\n\t\t\t\t\t\ttips = `<ul class=\"dagre-toolTip\">\r\n\t\t\t\t\t\t\t<li>${title}</li>\r\n\t\t\t\t\t\t\t<li>${codeLabel}</li>\r\n\t\t\t\t\t\t\t<li> ${billcode}</li>\r\n\t\t\t\t\t\t\t<li> ${transTypeLabel}:${transType}</li>\r\n\t\t\t\t\t\t</ul>`;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn tips;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.graph = new G6.Graph({\r\n\t\t\tid: 'mountNode', //dom Id\r\n\t\t\theigth: 250, // 网格的高度(不太管用，需进一步验证)\r\n\t\t\tplugins: [this.dagre, this.tooltip],\r\n\t\t\tdefaultIntersectBox: 'rect', // 使用矩形包围盒\r\n\t\t\tmodes: {\r\n\t\t\t\tdefault: ['panBlank', 'panNode', 'wheelZoom']\r\n\t\t\t}\r\n\t\t});\r\n\t\t//流程线条箭头设置\r\n\t\tthis.graph.edge({\r\n\t\t\tstyle: {\r\n\t\t\t\tendArrow: true\r\n\t\t\t},\r\n\t\t\tlabel(model) {\r\n\t\t\t\treturn model.shape;\r\n\t\t\t},\r\n\t\t\tsize: 1\r\n\t\t});\r\n\r\n\t\tthis.graph.node({\r\n\t\t\tshape: 'rect',\r\n\t\t\tstyle: {\r\n\t\t\t\tstroke: '#CCEAFF'\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.itemClickEvent();\r\n\t\tthis.graph.on('wheel', () => {\r\n\t\t\tlet wheelScrollZoom = this.graph.getZoom();\r\n\t\t\tthis.setState({\r\n\t\t\t\twheelScrollZoom\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\t//计算流程图的宽高，用途：让流程图居中显示 g6没有这个功能的API\r\n\tcalculaterGraphPosition = data => {\r\n\t\tlet graph = this.graph;\r\n\t\t/*\r\n\t\tsourceArr是节点sourceList和targetList的集合，数据套数据[[],[],...],\r\n\t\t流程图的列数graphColumnCount是sourceArr的长度加一，\r\n\t\t流程图的行数graphRowCount是sourceArr的子项最长一项的长度，\r\n\t\t */\r\n\t\tlet sourceArr = [];\r\n\t\tlet graphColumnCount = 0;\r\n\t\tlet graphRowCount = 0;\r\n\t\tif (data.nodes.length > 1) {\r\n\t\t\t//流程图有多个节点的时候\r\n\t\t\tdata.nodes.forEach(val => {\r\n\t\t\t\tif (val.source.length) {\r\n\t\t\t\t\tsourceArr.push(val.source);\r\n\t\t\t\t}\r\n\t\t\t\tif (val.target.length) {\r\n\t\t\t\t\tsourceArr.push(val.target);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (sourceArr.length) {\r\n\t\t\t\tgraphColumnCount = sourceArr.length + 1;\r\n\t\t\t\tlet lenArr = [];\r\n\t\t\t\tsourceArr.forEach((itemArr) => {\r\n\t\t\t\t\tlenArr.push(itemArr.length);\r\n\t\t\t\t});\r\n\t\t\t\tlenArr.sort((a, b) => b - a);\r\n\t\t\t\tgraphRowCount = lenArr[0];\r\n\r\n\t\t\t\tlet graphWidth = graphColumnCount * 136 + (graphColumnCount - 1) * 30;\r\n\t\t\t\tlet graphHeight = graphRowCount * 50 + (graphRowCount - 1) * 30;\r\n\r\n\t\t\t\tlet dagreScrollWrap = document.querySelector('.dagreScrollWrap');\r\n\t\t\t\tif (dagreScrollWrap && this.firstRender) {\r\n\t\t\t\t\tlet dagreScrollWrapHeight = dagreScrollWrap.clientHeight;\r\n\t\t\t\t\tlet dagreScrollWrapWidth = dagreScrollWrap.clientWidth;\r\n\t\t\t\t\tthis.dagreScrollWrapHeight = dagreScrollWrapHeight;\r\n\t\t\t\t\tthis.dagreScrollWrapWidth = dagreScrollWrapWidth;\r\n\r\n\t\t\t\t\tlet dy = (dagreScrollWrapHeight - graphHeight) / 2;\r\n\t\t\t\t\tlet dx = (dagreScrollWrapWidth - graphWidth) / 2;\r\n\t\t\t\t\tif (this.dagreScrollWrapHeight) {\r\n\t\t\t\t\t\tif (dx >= 0 && dy >= 0) {\r\n\t\t\t\t\t\t\tgraph.translate(dx, dy);\r\n\t\t\t\t\t\t} else if (dx >= 0 && dy <= 0) {\r\n\t\t\t\t\t\t\tgraph.translate(dx, 0);\r\n\t\t\t\t\t\t} else if (dy >= 0 && dx <= 0) {\r\n\t\t\t\t\t\t\tgraph.translate(0, dy);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\tgraphWidth,\r\n\t\t\t\t\t\t\tgraphHeight\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.firstChangeZoom = true;\r\n\t\t\t\t\t\tthis.firstRender = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else if (data.nodes.length === 1) {\r\n\t\t\t//只有一个节点的时候\r\n\t\t\tlet dagreScrollWrap = document.querySelector('.dagreScrollWrap');\r\n\t\t\tif (dagreScrollWrap && this.firstRender) {\r\n\t\t\t\tlet dagreScrollWrapHeight = dagreScrollWrap.clientHeight;\r\n\t\t\t\tlet dagreScrollWrapWidth = dagreScrollWrap.clientWidth;\r\n\t\t\t\tthis.dagreScrollWrapHeight = dagreScrollWrapHeight;\r\n\t\t\t\tthis.dagreScrollWrapWidth = dagreScrollWrapWidth;\r\n\t\t\t\tlet dy = (dagreScrollWrapHeight - 60) / 2;\r\n\t\t\t\tlet dx = (dagreScrollWrapWidth - 136) / 2;\r\n\t\t\t\tgraph.translate(dx, dy);\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tgraphWidth: 136,\r\n\t\t\t\t\tgraphHeight: 60\r\n\t\t\t\t});\r\n\t\t\t\tthis.firstRender = false;\r\n\t\t\t\tthis.firstChangeZoom = true;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// 渲染关系图\r\n\trenderDagre = data => {\r\n\t\t//渲染出流程图会走两次这个方法\r\n\t\tthis.calculaterGraphPosition(data);\r\n\r\n\t\tlet graph = this.graph;\r\n\t\tdragNodeChangePostion(graph);\r\n\t\tgraph.read(data); //把绘制流程图的数据传进去\r\n\t\tif (graph && this.currentZoom) {\r\n\t\t\t//图方法之后点击，保持点击前的大小\r\n\t\t\tgraph.zoom(this.currentZoom);\r\n\t\t}\r\n\t};\r\n\r\n\t// 节点的点击事件\r\n\titemClickEvent = () => {\r\n\t\tthis.graph.on('click', ev => {\r\n\t\t\tif (ev.item && ev.item.isNode) {\r\n\t\t\t\tlet selectedId = ev.item.id;\r\n\t\t\t\tlet selectedType = ev.item.model.type;\r\n\t\t\t\tif (selectedId !== this.state.selectedId) {\r\n\t\t\t\t\tthis.setState({ selectedId, selectedType }, () => {\r\n\t\t\t\t\t\tthis.props.getSelectId && this.props.getSelectId(selectedId);\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// if (this.state.extract) {\r\n\t\t\t\t\t// \tlet data = this.changeColor(this.state.relatedData);\r\n\t\t\t\t\t// \tthis.setState({ relatedData: data }, () => this.renderDagre(data));\r\n\t\t\t\t\t// } else {\r\n\t\t\t\t\t// \tlet data = this.changeColor(this.state.data);\r\n\t\t\t\t\t// \tthis.setState({ data }, () => this.renderDagre(data));\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tlet data = this.changeColor(this.state.data);\r\n\t\t\t\t\tthis.setState({ data }, () => this.renderDagre(data));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.graph.on('dblclick', ev => {\r\n\t\t\tif (ev.item && ev.item.type === 'node') {\r\n\t\t\t\tlet selectedId = ev.item.model.id;\r\n\t\t\t\tlet type = this.state.data.nodes.find(elem => {\r\n\t\t\t\t\treturn elem.id == selectedId;\r\n\t\t\t\t}).type;\r\n\t\t\t\tlet transtype = this.state.data.nodes.find(elem => {\r\n\t\t\t\t\treturn elem.id == selectedId;\r\n\t\t\t\t}).transtype;\r\n\t\t\t\tthis.props.onSelect && this.props.onSelect(selectedId, type, transtype);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * 改变选中节点的颜色\r\n\t */\r\n\tchangeColor = data => {\r\n\t\tthis.currentZoom = this.graph.getZoom();\r\n\t\tdata.nodes.forEach(item => {\r\n\t\t\tif (item && item.color) {\r\n\t\t\t\titem.color = '#fff';\r\n\t\t\t}\r\n\t\t});\r\n\t\tdata.edges.forEach(item => {\r\n\t\t\tif (item && item.color) {\r\n\t\t\t\titem.color = '#888';\r\n\t\t\t}\r\n\t\t});\r\n\t\tlet { selectedId } = this.state;\r\n\t\tif (selectedId) {\r\n\t\t\tlet relatedData = getRelated(selectedId, this.state.data); // 未抽取视图的相关联数据\r\n\t\t\t// let relatedData2 = extract ? getRelated(selectedId, relatedData) : { nodes: [], edges: [] }; // 抽取路径后视图的相关联数据\r\n\t\t\tlet nodes = [...relatedData.nodes];\r\n\t\t\tlet edges = [...relatedData.edges];\r\n\t\t\tif (nodes) {\r\n\t\t\t\tnodes.forEach(item => {\r\n\t\t\t\t\tif (item) {\r\n\t\t\t\t\t\tif (item.id === this.state.selectedId) {\r\n\t\t\t\t\t\t\tif (item.label && item.label.fill) {\r\n\t\t\t\t\t\t\t\titem.label.fill = '#007ACE';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\titem.color = '#CCEAFF';\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (item.label && item.label.fill) {\r\n\t\t\t\t\t\t\t\titem.label.fill = '#F87321';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\titem.color = '#FFE19D';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tedges.forEach(item => {\r\n\t\t\t\t\tif (item && item.color) {\r\n\t\t\t\t\t\titem.color = 'green';\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn data;\r\n\t};\r\n\r\n\t// 抽取路径按钮的点击事件\r\n\thandleClick = () => {\r\n\t\tlet { extractTip, renderNewData, extract, originPk, originType } = this.props;\r\n\t\tlet { selectedId, selectedType } = this.state;\r\n\t\tif (!extract) {\r\n\t\t\tif (selectedId && selectedType) {\r\n\t\t\t\trenderNewData(selectedId, selectedType, true)\r\n\t\t\t} else {\r\n\t\t\t\ttoast({ color: 'warning', content: extractTip });\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\trenderNewData(originPk, originType, false)\r\n\t\t}\r\n\t};\r\n\r\n\t//每次流程图渲染的时候，让图中部居中\r\n\tcalculatePostionbBeforeRender = size => {\r\n\t\tlet { graphHeight, graphWidth, wheelScrollZoom } = this.state;\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet dagreScrollWrap = document.querySelector('.dagreScrollWrap');\r\n\t\t\tif (dagreScrollWrap) {\r\n\t\t\t\tlet dagreScrollHeight = dagreScrollWrap.clientHeight;\r\n\t\t\t\tlet dagreScrollWidth = dagreScrollWrap.clientWidth;\r\n\r\n\t\t\t\tif (dagreScrollHeight - graphHeight >= 0) {\r\n\t\t\t\t\t//显示表格，且流程图高度小于于可视区\r\n\t\t\t\t\tif (!this.dagreScrollH) {\r\n\t\t\t\t\t\tthis.dagreScrollH = dagreScrollHeight;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (graphHeight) {\r\n\t\t\t\t\t\t\tif (size === false) {\r\n\t\t\t\t\t\t\t\t//显示表格的时候\r\n\t\t\t\t\t\t\t\tif (!this.hasTableDy) {\r\n\t\t\t\t\t\t\t\t\tlet dy2 = (dagreScrollHeight - graphHeight) / 2;\r\n\t\t\t\t\t\t\t\t\tlet dy1 = (dagreScrollHeight * 2 - graphHeight) / 2;\r\n\t\t\t\t\t\t\t\t\tlet dy = dy2 - dy1;\r\n\t\t\t\t\t\t\t\t\tthis.hasTableDy = dy2;\r\n\t\t\t\t\t\t\t\t\tthis.graph.translate(0, dy);\r\n\t\t\t\t\t\t\t\t\tthis.prevDy = dy;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (dagreScrollHeight - graphHeight < 0) {\r\n\t\t\t\t\t//流程图高度大于可视区\r\n\t\t\t\t\tif (dagreScrollHeight) {\r\n\t\t\t\t\t\tthis.dagreScrollH = graphHeight;\r\n\t\t\t\t\t\tif (this.firstChangeZoom) {\r\n\t\t\t\t\t\t\t//在流程图的宽高大于dagreScrollWrap宽高的时候，缩放比例按照差值更多的一方来计算\r\n\t\t\t\t\t\t\tthis.firstChangeZoom = false;\r\n\t\t\t\t\t\t\tlet zoomX = dagreScrollWidth / graphWidth;\r\n\t\t\t\t\t\t\tlet zoomY = dagreScrollHeight / graphHeight;\r\n\t\t\t\t\t\t\tif (zoomX < zoomY) {\r\n\t\t\t\t\t\t\t\tthis.currentZoom = zoomX;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.currentZoom = zoomY;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (wheelScrollZoom) {\r\n\t\t\t\t\t\t\t\tthis.graph.zoom(wheelScrollZoom);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis.graph.zoom(this.currentZoom);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (dagreScrollWidth - graphWidth >= 0) {\r\n\t\t\t\t\t//流程图宽度小于可视区\r\n\t\t\t\t\tif (!this.dagreScrollW) {\r\n\t\t\t\t\t\tthis.dagreScrollW = dagreScrollWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!this.dagreScrollW) {\r\n\t\t\t\t\t\tthis.dagreScrollH = graphWidth;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, 50);\r\n\t};\r\n\r\n\trender() {\r\n\t\t//size 表格是否显示的控制参数 Boolean  默认是false不显示表格 true是显示表格\r\n\t\tlet { size, extractBtns, extract } = this.props;\r\n\r\n\t\tlet btnTitle;\r\n\t\tif (extractBtns) {\r\n\t\t\tbtnTitle = extract ? extractBtns[0] : extractBtns[1];\r\n\t\t}\r\n\t\tthis.calculatePostionbBeforeRender(size);\r\n\t\treturn (\r\n\t\t\t<div\r\n\t\t\t\tclassName={`${this.props.className ? this.props.className : ''} dagre-area `}\r\n\t\t\t\tstyle={{ height: `${size ? '96%' : '50%'}` }}\r\n\t\t\t>\r\n\t\t\t\t{btnTitle && (\r\n\t\t\t\t\t<NCButton\r\n\t\t\t\t\t\tclassName=\"button-primary dagre-extract\"\r\n\t\t\t\t\t\tfieldid={extract ? 'show-all' : 'dagre-extract'}\r\n\t\t\t\t\t\tonClick={this.handleClick}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{btnTitle}\r\n\t\t\t\t\t</NCButton>\r\n\t\t\t\t)}\r\n\t\t\t\t<div className=\"dagreScrollWrap\">\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tclassName=\"dagreScroll\"\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t//单据追溯点击节点，数据量大时会出现模糊现象，先这样修改，有问题再说\r\n\t\t\t\t\t\t\theight: `${'100%'}`,\r\n\t\t\t\t\t\t\twidth: `${'100%'}`\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<div id=\"mountNode\" className=\"dagre\" style={{ width: '100%' }} />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n","/**\r\n * 节点信息生成\r\n * **/\r\nconst flowFormatNode = (data) => {\r\n    return data.map( (item, index) => {\r\n        return {\r\n            id: item.act_id,\r\n\t\t\tlabel:{     \r\n\t\t\t\ttext: item.label\r\n\t\t\t},\r\n            name: item.act_name,\r\n        }\r\n    })\r\n}\r\n\r\n/**\r\n * 流程节点关系数组生成\r\n * **/\r\nconst createEdges = (node) => {\r\n    switch (node.isForward) {\r\n        case '0':\r\n            // 0表示节点是当前节点，当前节点找上下游\r\n            let sourceEdges = node.source.map((item) => {\r\n                return { source: item, target: node.id };\r\n            });\r\n            let targetEdges = node.target.map((item) => {\r\n                return { source: node.id, target: item };\r\n            });\r\n            return [ ...sourceEdges, ...targetEdges ];\r\n            break;\r\n        case '1':\r\n            // 1表示下游节点，下游节点找下游\r\n            return node.target.map((item) => {\r\n                return { source: node.id, target: item };\r\n            });\r\n            break;\r\n        case '-1':\r\n            // -1表示上游节点，上游节点找上游\r\n            return node.source.map((item) => {\r\n                return { source: item, target: node.id };\r\n            });\r\n            break;\r\n        default:\r\n            return [];\r\n            break;\r\n    }\r\n};\r\n/**\r\n * 节点简单拖拽位置变化\r\n * **/\r\nconst dragNodeChangePostion = (graph) => {\r\n    let node;\r\n    let dx;\r\n    let dy;\r\n    graph.on('node:dragstart', ev=>{\r\n      const {item} = ev;\r\n      const model = item.getModel();\r\n      node = item;\r\n      dx = model.x - ev.x;\r\n      dy = model.y - ev.y;\r\n    });\r\n    graph.on('node:drag', ev=>{\r\n      node && graph.update(node, {\r\n        x: ev.x+dx,\r\n        y: ev.y+dy\r\n      });\r\n    });\r\n    graph.on('node:dragend', ev=>{\r\n      node = undefined;\r\n    });\r\n}\r\n\r\n/**\r\n * 生成初始化的当前所属节点\r\n * **/\r\nconst generateInitSelected = (data) => {\r\n    return data.filter( (item, index) => {\r\n        return item.ispassroute\r\n    })\r\n}\r\n\r\n/**\r\n * 判断两个对象数组是否相等 【升级之后没有用的】\r\n * **/\r\nconst equalArray = (arr1, arr2) => {\r\n    if(!arr1 || !arr2) return false;\r\n    if(Object.prototype.toString.call(arr1).slice(8, -1) !== 'Array' || Object.prototype.toString.call(arr2).slice(8, -1) !== 'Array') return false; \r\n    return JSON.stringify(arr1) === JSON.stringify(arr2)\r\n}\r\n\r\n/**\r\n * 查找上下游的节点和路径 参数data: 查找相关数据的原始数据范围\r\n */\r\nconst getRelated = (keyNodeId, data) => {\r\n\t\tlet edges = [];\r\n\t\tlet sources = [];\r\n\t\tlet targets = [];\r\n\t\tlet getSource = (id) => {\r\n\t\t\tlet sourceEdges = data.edges.filter(({ target }) => target === id);\r\n\t\t\tlet sourceIds = sourceEdges.map((item) => item.source);\r\n\t\t\tedges.push(...sourceEdges);\r\n\t\t\tsources.push(...sourceIds);\r\n\t\t\tif (sourceIds.length > 0) {\r\n\t\t\t\tsourceIds.forEach((item) => getSource(item));\r\n\t\t\t}\r\n\t\t};\r\n\t\tlet getTargets = (id) => {\r\n\t\t\tlet targetEdges = data.edges.filter(({ source }) => source === id);\r\n\t\t\tlet targetIds = targetEdges.map((item) => item.target);\r\n\t\t\tedges.push(...targetEdges);\r\n\t\t\ttargets.push(...targetIds);\r\n\t\t\tif (targetIds.length > 0) {\r\n\t\t\t\ttargetIds.forEach((item) => getTargets(item));\r\n\t\t\t}\r\n\t\t};\r\n\t\tgetSource(keyNodeId);\r\n\t\tgetTargets(keyNodeId);\r\n\t\tedges = [ ...new Set(edges) ];\r\n\t\tlet nodeIds = [ ...new Set([ ...sources, keyNodeId, ...targets ]) ]; // 用 Set 去重\r\n\t\tlet nodes = nodeIds.map((item) => {\r\n\t\t\treturn data.nodes.find((ele) => ele.id === item);\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tedges,\r\n\t\t\tnodes\r\n\t\t};\r\n\t};\r\nexport {\r\n    flowFormatNode,\r\n    createEdges,\r\n    dragNodeChangePostion,\r\n    generateInitSelected,\r\n    equalArray,\r\n    getRelated\r\n}","!function(t,o){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=o(require(\"@antv/g6\")):\"function\"==typeof define&&define.amd?define([\"@antv/g6\"],o):\"object\"==typeof exports?exports[\"plugin.tool.tooltip\"]=o(require(\"@antv/g6\")):t[\"plugin.tool.tooltip\"]=o(t.G6)}(window,function(t){return function(t){var o={};function e(n){if(o[n])return o[n].exports;var i=o[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=t,e.c=o,e.d=function(t,o,n){e.o(t,o)||Object.defineProperty(t,o,{enumerable:!0,get:n})},e.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},e.t=function(t,o){if(1&o&&(t=e(t)),8&o)return t;if(4&o&&\"object\"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:t}),2&o&&\"string\"!=typeof t)for(var i in t)e.d(n,i,function(o){return t[o]}.bind(null,i));return n},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,\"a\",o),o},e.o=function(t,o){return Object.prototype.hasOwnProperty.call(t,o)},e.p=\"\",e(e.s=133)}({133:function(t,o,e){var n=Object.assign||function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t};var i=e(3),r=i.Util,p=function(){function t(o){!function(t,o){if(!(t instanceof o))throw new TypeError(\"Cannot call a class as a function\")}(this,t),this.options=n({dx:10,dy:10,getTooltip:function(t){var o=t.item;if(o){var e=o.getModel().tooltip;if(e){var n=\"\",i=o.type;return r.isArray(e)?e.forEach(function(t){n+='<li style=\"font-size: 12px;list-style-type: none;\"><span>'+t[0]+\"</span>: \"+t[1]+\"</li>\"}):(i=e.title,e.list.forEach(function(t){n+='<li style=\"font-size: 12px;list-style-type: none;\"><span>'+t[0]+\"</span>: \"+t[1]+\"</li>\"})),'\\n              <div class=\"g6-tooltip\" style=\"\\n                position: absolute;\\n                white-space: nowrap;\\n                zIndex: 8;\\n                transition: visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1);\\n                background-color: rgba(255, 255, 255, 0.9);\\n                box-shadow: 0px 0px 10px #aeaeae;\\n                border-radius: 3px;\\n                color: rgb(87, 87, 87);\\n                line-height: 20px;\\n                padding: 10px 10px 6px 10px;\\n              \">\\n                <h4 class=\"g6-tooltip-title\" style=\"\\n                  margin: 0;\\n                \">'+i+'</h4>\\n                <ul class=\"g6-tooltip-list\" style=\"\\n                  padding: 0;\\n                  margin: 0;\\n                  margin-top: 4px;\\n                \">\\n                  '+n+\"\\n                </ul>\\n              </div>\\n            \"}}return null}},o)}return t.prototype.init=function(){var t=this,o=this.graph;o.on(\"mouseenter\",function(o){o.shape&&t.onMouseEnter(o)}),o.on(\"mousemove\",function(o){t.onMouseMove(o)}),o.on(\"mouseleave\",function(o){t.onMouseLeave(o)})},t.prototype.onMouseEnter=function(t){var o=this.graph.getGraphContainer(),e=this.options.getTooltip(t),n=this.tooltip;n&&this.tooltip.destroy(),e?((n=r.createDOM(e)).css({position:\"absolute\"}),o.appendChild(n)):n=null,this.tooltip=n},t.prototype.onMouseMove=function(t){var o=t.domX,e=t.domY,n=this.tooltip;if(n){var i=this.graph,p=r.getOuterWidth(n),s=r.getOuterHeight(n),l=i.getWidth(),u=i.getHeight();n.css({top:this._getTop(s,u,e),left:this._getLeft(p,l,o)})}},t.prototype.onMouseLeave=function(){this.tooltip&&(this.tooltip.destroy(),this.tooltip=null)},t.prototype._getTop=function(t,o,e){var n=this.options.dy;return 2*t>=o?\"0px\":e<t+n?e+n+\"px\":e-t-n+\"px\"},t.prototype._getLeft=function(t,o,e){var n=this.options.dx;return 2*t>=o?\"0px\":o-e-n<t?e-t-n+\"px\":e+n+\"px\"},t.prototype.destroy=function(){this.tooltip&&this.tooltip.destroy()},t}();i.Plugins[\"tool.tooltip\"]=p,t.exports=p},3:function(o,e){o.exports=t}})});\n//# sourceMappingURL=plugin.tool.tooltip.js.map"],"sourceRoot":""}